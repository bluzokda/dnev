<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Моя Памятка</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: #3a4f76;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 2rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
        }
        
        .date-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 8px 15px;
            border-radius: 30px;
            color: #3a4f76;
        }
        
        .date-selector input {
            border: none;
            font-size: 1rem;
            color: #3a4f76;
            font-weight: 500;
        }
        
        .main-content {
            display: flex;
            min-height: 500px;
        }
        
        .sidebar {
            width: 250px;
            background: #f0f4f8;
            padding: 20px;
            border-right: 1px solid #ddd;
        }
        
        .sidebar h3 {
            color: #3a4f76;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3a4f76;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-item:hover, .nav-item.active {
            background: #3a4f76;
            color: white;
        }
        
        .content {
            flex: 1;
            padding: 20px;
        }
        
        .tab {
            display: none;
        }
        
        .tab.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #3a4f76;
            font-weight: 500;
        }
        
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #45a049;
        }
        
        .btn-secondary {
            background: #f44336;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #d32f2f;
        }
        
        .btn-warning {
            background: #ff9800;
            color: white;
        }
        
        .btn-warning:hover {
            background: #e68a00;
        }
        
        .record-display {
            background: #e8f0fe;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #3a4f76;
        }
        
        .record-display p {
            margin: 8px 0;
            font-size: 1.1rem;
        }
        
        .record-display strong {
            color: #3a4f76;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #d0e3ff;
        }
        
        .stat-card h3 {
            color: #3a4f76;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #3a4f76;
        }

        .archive-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .subjects-list {
            width: 250px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .subject-item {
            padding: 8px 10px;
            margin-bottom: 6px;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        .subject-item:hover {
            background: #e3f2fd;
        }
        
        .subject-item.active {
            background: #2196f3;
            color: white;
        }
        
        .archive-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .archive-table th, .archive-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .archive-table th {
            background-color: #3a4f76;
            color: white;
        }
        
        .archive-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .archive-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .delete-btn:hover {
            background: #d32f2f;
        }
        
        .search-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-book"></i>
                <h1>Моя Памятка</h1>
            </div>
            <div class="date-selector">
                <i class="fas fa-calendar-alt"></i>
                <input type="date" id="date-selector">
            </div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <h3>Меню</h3>
                <div class="nav-item active" data-tab="main">
                    <i class="fas fa-home"></i>
                    <span>Главная</span>
                </div>
                <div class="nav-item" data-tab="archive">
                    <i class="fas fa-archive"></i>
                    <span>Архив</span>
                </div>
            </div>
            
            <div class="content">
                <div class="tab active" id="main">
                    <div class="form-group">
                        <label for="subject">Предмет / Деятельность</label>
                        <select id="subject">
                            <option value="">Выберите предмет</option>
                            <option value="Алгебра">Алгебра</option>
                            <option value="Геометрия">Геометрия</option>
                            <option value="Информатика">Информатика</option>
                            <option value="Русский язык">Русский язык</option>
                            <option value="Литература">Литература</option>
                            <option value="Английский">Английский</option>
                            <option value="География">География</option>
                            <option value="Общество">Общество</option>
                            <option value="История">История</option>
                            <option value="ОБЖ">ОБЖ</option>
                            <option value="ВиС">ВиС</option>
                            <option value="Физика">Физика</option>
                            <option value="Химия">Химия</option>
                            <option value="Биология">Биология</option>
                            <option value="ФЗК">ФЗК</option>
                            <option value="ИП">ИП</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="grade">Оценка (1–5)</label>
                        <select id="grade">
                            <option value="">Выберите</option>
                            <option value="5">5 — Отлично!</option>
                            <option value="4">4 — Хорошо</option>
                            <option value="3">3 — Средне</option>
                            <option value="2">2 — Плохо</option>
                            <option value="1">1 — Очень плохо</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="absence">Пропуск</label>
                        <select id="absence">
                            <option value="">Нет</option>
                            <option value="ill">Болел</option>
                            <option value="lazy">Не хотел</option>
                            <option value="busy">Был занят</option>
                            <option value="vacation">Отпуск</option>
                            <option value="other">Другое</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="comment">Комментарий</label>
                        <textarea id="comment" placeholder="Что было интересного?"></textarea>
                    </div>

                    <div class="actions">
                        <button class="btn btn-primary" id="save-btn">
                            <i class="fas fa-plus"></i> Добавить
                        </button>
                        <button class="btn btn-warning" id="load-btn">
                            <i class="fas fa-sync"></i> Загрузить
                        </button>
                        <button class="btn btn-secondary" id="reset-btn">
                            <i class="fas fa-trash"></i> Очистить
                        </button>
                    </div>

                    <div class="record-display" id="record-display" style="display: none;">
                        <h3>Последняя запись:</h3>
                        <p><strong>Дата:</strong> <span id="display-date"></span></p>
                        <p><strong>Предмет:</strong> <span id="display-subject"></span></p>
                        <p><strong>Оценка:</strong> <span id="display-grade"></span></p>
                        <p><strong>Пропуск:</strong> <span id="display-absence"></span></p>
                        <p><strong>Комментарий:</strong> <span id="display-comment"></span></p>
                    </div>

                    <div class="stats">
                        <div class="stat-card">
                            <h3>Ср. оценка</h3>
                            <div class="stat-value" id="avg-grade">-</div>
                        </div>
                        <div class="stat-card">
                            <h3>Всего</h3>
                            <div class="stat-value" id="total-records">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Пропусков</h3>
                            <div class="stat-value" id="total-absences">0</div>
                        </div>
                    </div>
                </div>

                <div class="tab" id="archive">
                    <h3>Архив записей</h3>
                    <div class="archive-controls">
                        <div class="subjects-list" id="subjects-list"></div>
                        <div style="flex: 1;">
                            <input type="text" class="search-input" id="search-subject" placeholder="Поиск...">
                        </div>
                    </div>
                    <table class="archive-table">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Предмет</th>
                                <th>Оценка</th>
                                <th>Пропуск</th>
                                <th>Комментарий</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="archive-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('date-selector');
            const today = new Date().toISOString().split('T')[0];
            dateInput.value = today;

            // Переключение вкладок
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    item.classList.add('active');
                    document.getElementById(item.dataset.tab).classList.add('active');
                    if (item.dataset.tab === 'archive') loadArchive();
                });
            });

            // Загрузка
            loadDataForDate(today);
            updateStats();

            dateInput.addEventListener('change', () => loadDataForDate(dateInput.value));
            document.getElementById('load-btn').addEventListener('click', () => loadDataForDate(dateInput.value));

            // Добавление
            document.getElementById('save-btn').addEventListener('click', function() {
                const date = dateInput.value;
                const subject = document.getElementById('subject').value;
                if (!subject) {
                    alert('Выберите предмет!');
                    return;
                }

                const data = {
                    subject,
                    grade: document.getElementById('grade').value || '—',
                    absence: document.getElementById('absence').value || '',
                    comment: document.getElementById('comment').value || '—',
                };

                const entries = JSON.parse(localStorage.getItem(`diary_${date}`)) || [];
                entries.push(data);
                localStorage.setItem(`diary_${date}`, JSON.stringify(entries));

                clearForm();
                loadDataForDate(date);
                updateStats();
                if (document.querySelector('.nav-item.active')?.dataset?.tab === 'archive') {
                    loadArchive();
                }
                alert('✅ Запись добавлена!');
            });

            document.getElementById('reset-btn').addEventListener('click', () => {
                if (confirm('Очистить форму?')) clearForm();
            });

            // === Функции ===
            function loadDataForDate(date) {
                const entries = JSON.parse(localStorage.getItem(`diary_${date}`)) || [];
                const display = document.getElementById('record-display');
                if (entries.length > 0) {
                    const last = entries[entries.length - 1];
                    Object.entries(last).forEach(([key, val]) => {
                        const el = document.getElementById(key);
                        if (el) el.value = val;
                    });
                    document.getElementById('display-date').textContent = formatDate(date);
                    document.getElementById('display-subject').textContent = last.subject;
                    document.getElementById('display-grade').textContent = getGradeText(last.grade);
                    document.getElementById('display-absence').textContent = getAbsenceText(last.absence);
                    document.getElementById('display-comment').textContent = last.comment;
                    display.style.display = 'block';
                } else {
                    clearForm();
                    display.style.display = 'none';
                }
            }

            function clearForm() {
                document.getElementById('subject').value = '';
                document.getElementById('grade').value = '';
                document.getElementById('absence').value = '';
                document.getElementById('comment').value = '';
                document.getElementById('record-display').style.display = 'none';
            }

            function formatDate(dateStr) {
                return new Date(dateStr).toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' });
            }

            function getGradeText(grade) {
                return { '5': '5 — Отлично!', '4': '4 — Хорошо', '3': '3 — Средне', '2': '2 — Плохо', '1': '1 — Очень плохо' }[grade] || '—';
            }

            function getAbsenceText(value) {
                const map = { ill: 'Болел', lazy: 'Не хотел', busy: 'Был занят', vacation: 'Отпуск', other: 'Другое', '': 'Нет' };
                return map[value] || '—';
            }

            function updateStats() {
                let total = 0, absences = 0, grades = 0, count = 0;
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('diary_')) {
                        const entries = JSON.parse(localStorage.getItem(key)) || [];
                        total += entries.length;
                        entries.forEach(e => {
                            if (e.absence) absences++;
                            if (e.grade && !isNaN(e.grade)) { grades += +e.grade; count++; }
                        });
                    }
                }
                document.getElementById('total-records').textContent = total;
                document.getElementById('total-absences').textContent = absences;
                document.getElementById('avg-grade').textContent = count ? (grades / count).toFixed(1) : '—';
            }

            // === Архив ===
            function loadArchive() {
                const tbody = document.getElementById('archive-body');
                const subjectsList = document.getElementById('subjects-list');
                tbody.innerHTML = '';
                subjectsList.innerHTML = '';

                const allData = [];
                const subjectsMap = {};

                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('diary_')) {
                        const date = key.split('_')[1];
                        const entries = JSON.parse(localStorage.getItem(key)) || [];
                        entries.forEach(entry => {
                            allData.push({ date, ...entry });
                            subjectsMap[entry.subject] = (subjectsMap[entry.subject] || 0) + 1;
                        });
                    }
                }

                allData.sort((a, b) => new Date(b.date) - new Date(a.date));

                allData.forEach((data, index) => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${formatDate(data.date)}</td>
                        <td>${data.subject}</td>
                        <td>${getGradeText(data.grade)}</td>
                        <td>${getAbsenceText(data.absence)}</td>
                        <td>${data.comment}</td>
                        <td>
                            <button class="delete-btn" onclick="deleteByIndex('${data.date}', ${allData.indexOf(data)})">Удалить</button>
                        </td>
                    `;
                });

                Object.entries(subjectsMap).sort((a, b) => b[1] - a[1]).forEach(([sub, cnt]) => {
                    const div = document.createElement('div');
                    div.className = 'subject-item';
                    div.textContent = `${sub} — ${cnt}`;
                    div.onclick = () => filterBySubject(sub);
                    subjectsList.appendChild(div);
                });

                document.getElementById('search-subject').oninput = function() {
                    const q = this.value.toLowerCase();
                    document.querySelectorAll('.subject-item').forEach(el => {
                        el.style.display = el.textContent.toLowerCase().includes(q) ? 'block' : 'none';
                    });
                };
            }

            window.filterBySubject = function(subject) {
                const tbody = document.getElementById('archive-body');
                tbody.innerHTML = '';
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('diary_')) {
                        const date = key.split('_')[1];
                        const entries = JSON.parse(localStorage.getItem(key)) || [];
                        entries.forEach((entry, idx) => {
                            if (entry.subject === subject) {
                                const row = tbody.insertRow();
                                row.innerHTML = `
                                    <td>${formatDate(date)}</td>
                                    <td>${entry.subject}</td>
                                    <td>${getGradeText(entry.grade)}</td>
                                    <td>${getAbsenceText(entry.absence)}</td>
                                    <td>${entry.comment}</td>
                                    <td>
                                        <button class="delete-btn" onclick="deleteByIndex('${date}', ${idx})">Удалить</button>
                                    </td>
                                `;
                            }
                        });
                    }
                }
            };

            window.deleteByIndex = function(date, index) {
                const key = `diary_${date}`;
                const entries = JSON.parse(localStorage.getItem(key)) || [];
                if (index >= 0 && index < entries.length) {
                    entries.splice(index, 1);
                    localStorage.setItem(key, JSON.stringify(entries));
                    loadArchive();
                    updateStats();
                    loadDataForDate(document.getElementById('date-selector').value);
                }
            };
        });
    </script>
</body>
</html>
